import './polyfills.server.mjs';
import{h as u}from"./chunk-SQVLAE5Q.mjs";import{i as W}from"./chunk-ZSAWBTYV.mjs";import{a as d}from"./chunk-5NRLYQRM.mjs";import{F as f}from"./chunk-2RBLLN6M.mjs";import{k as S,m as n,n as v,o as m}from"./chunk-KL6F6H7P.mjs";import{X as a,ca as c,ha as l,i as r}from"./chunk-KHPBT355.mjs";var w=(()=>{class o{static{this.type="[Wishlist] Get"}}return o})(),I=(()=>{class o{static{this.type="[Wishlist] post"}constructor(t){this.payload=t}}return o})(),A=(()=>{class o{static{this.type="[Wishlist] delete"}constructor(t){this.id=t}}return o})();var y=(()=>{class o{constructor(){this.http=l(f),this.skeletonLoader=!1}getWishlistItems(){return this.http.get(`${d.baseURL}wishlist`)}addToWishlist(t){return this.http.post(`${d.baseURL}wishlist`,{product_id:t})}removeFromWishlist(t){return this.http.delete(`${d.baseURL}wishlist/${t}`)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var h=class p{constructor(){this.store=l(S),this.router=l(u),this.wishlistService=l(y),this.notificationService=l(W)}static wishlistItems(s){return s.wishlist}static wishlistIds(s){return s.wishlistIds}getWishlistItems(s){if(this.store.selectSnapshot(t=>t.auth&&t.auth.access_token))return this.wishlistService.skeletonLoader=!0,this.wishlistService.getWishlistItems().pipe(a({next:t=>{let i=Array.isArray(t)?t:t.data||[],e=i.map(g=>g.id);s.patchState({wishlist:{data:i,total:t?.total?t.total:i.length},wishlistIds:e})},complete:()=>{this.wishlistService.skeletonLoader=!1},error:t=>{throw this.wishlistService.skeletonLoader=!1,new Error(t?.error?.message)}}))}add(s,t){if(!this.store.selectSnapshot(e=>e.auth&&e.auth.access_token)){this.notificationService.showError("Please login to add items to wishlist.");return}let i=t.payload?.product_id;if(i)return this.wishlistService.addToWishlist(i).pipe(a({next:()=>{let e=s.getState();e.wishlistIds.includes(i)||s.patchState({wishlistIds:[...e.wishlistIds,i]}),this.notificationService.showSuccess("Added to wishlist."),this.store.dispatch(new w)},error:e=>{this.notificationService.showError(e?.error?.message||"Failed to add to wishlist.")}}))}delete(s,{id:t}){return this.wishlistService.removeFromWishlist(t).pipe(a({next:()=>{let i=s.getState();s.patchState({wishlist:{data:i.wishlist.data.filter(e=>e.id!==t),total:i.wishlist.total-1},wishlistIds:i.wishlistIds.filter(e=>e!==t)}),this.notificationService.showSuccess("Removed from wishlist.")},error:i=>{this.notificationService.showError(i?.error?.message||"Failed to remove from wishlist.")}}))}static{this.\u0275fac=function(t){return new(t||p)}}static{this.\u0275prov=c({token:p,factory:p.\u0275fac})}};r([n(w)],h.prototype,"getWishlistItems",null);r([n(I)],h.prototype,"add",null);r([n(A)],h.prototype,"delete",null);r([m()],h,"wishlistItems",null);r([m()],h,"wishlistIds",null);h=r([v({name:"wishlist",defaults:{wishlist:{data:[],total:0},wishlistIds:[]}})],h);export{w as a,I as b,A as c,y as d,h as e};
