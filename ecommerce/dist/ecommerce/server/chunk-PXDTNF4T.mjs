import './polyfills.server.mjs';
import{a as O,b as I,c as R,d as T,e as x,f as M,g as z,h as F,i as $,j as U}from"./chunk-UK34CG32.mjs";import{a as G}from"./chunk-BCLMTEV5.mjs";import{h as H}from"./chunk-SQVLAE5Q.mjs";import{a as P}from"./chunk-5NRLYQRM.mjs";import{F as E}from"./chunk-2RBLLN6M.mjs";import{k as j,m as i,n as w,o as n}from"./chunk-KL6F6H7P.mjs";import{E as k,X as h,ca as m,h as b,ha as y,i as c,p as L}from"./chunk-KHPBT355.mjs";import{a as p,b as g}from"./chunk-S6KH3LOX.mjs";var q=(()=>{class u{constructor(){this.http=y(E),this.skeletonLoader=!1,this.skeletonCategoryProductLoader=!1,this.productFilter=!1,this.searchSkeleton=!1}getProducts(r){let e=p({companyInfoId:P.companyInfoId},r);return this.http.get(`${P.baseURL}product`,{params:e}).pipe(L(o=>({data:o.data||o.products||[],total:o.total||0,current_page:o.page||1,per_page:o.pageSize||20,last_page:o.totalPages||1})))}getProductBySlug(r){return this.http.get(`${P.baseURL}product/${r}`).pipe(L(e=>e.product||e))}getProductBySearchList(r){let e=p({companyInfoId:P.companyInfoId},r);return this.http.get(`${P.baseURL}product`,{params:e}).pipe(L(o=>({data:o.data||o.products||[],total:o.total||0,current_page:o.page||1,per_page:o.pageSize||20,last_page:o.totalPages||1})))}static{this.\u0275fac=function(e){return new(e||u)}}static{this.\u0275prov=m({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})();var d=class v{constructor(){this.store=y(j),this.router=y(H),this.productService=y(q),this.themeOptionService=y(G)}static product(t){return t.product}static productByIds(t){return t.productByIds}static productBySearch(t){return t.productBySearch}static productBySearchList(t){return t.productBySearchList}static selectedProduct(t){return t.selectedProduct}static relatedProducts(t){return t.relatedProducts}static categoryProducts(t){return t.categoryProducts}static categoryProductsTotal(t){return t.categoryProductsTotal}static storeProducts(t){return t.storeProducts}static menuProducts(t){return t.menuProducts}static moreProduct(t){return t.moreProduct}getProducts(t,r){return this.productService.skeletonLoader=!0,this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=e.data||[];if(r?.payload){if(r?.payload?.category&&(o=o.filter(a=>a?.categories?.length&&a.categories.some(s=>r?.payload?.category?.split(",")?.includes(s.slug))),o=o.length?o:e.data),r?.payload?.brand){let a=r.payload.brand.split(",");o=o.filter(s=>s?.brand&&a.includes(s.brand.slug))}if(r?.payload?.color){let a=r.payload.color.split(",");o=o.filter(s=>s?.colors?.length&&s.colors.some(l=>a.includes(l.slug)))}r?.payload?.sortBy?r?.payload?.sortBy==="asc"?o=o.sort((a,s)=>a.id-s.id):r?.payload?.sortBy==="desc"?o=o.sort((a,s)=>s.id-a.id):r?.payload?.sortBy==="a-z"?o=o.sort((a,s)=>a.name.localeCompare(s.name)):r?.payload?.sortBy==="z-a"?o=o.sort((a,s)=>s.name.localeCompare(a.name)):r?.payload?.sortBy==="low-high"?o=o.sort((a,s)=>(a.sale_price||a.price)-(s.sale_price||s.price)):r?.payload?.sortBy==="high-low"&&(o=o.sort((a,s)=>(s.sale_price||s.price)-(a.sale_price||a.price))):o=o.sort((a,s)=>a.id-s.id),r?.payload?.search&&(o=o.filter(a=>a.name.toLowerCase().includes(r?.payload?.search.toLowerCase())))}t.patchState({product:{data:o,total:o.length?o.length:e.data?.length||0}})},complete:()=>{this.productService.skeletonLoader=!1},error:e=>{throw this.productService.skeletonLoader=!1,new Error(e?.error?.message)}}))}getProductByIds(t,r){return this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();t.patchState(g(p({},o),{productByIds:e.data}))},error:e=>{throw new Error(e?.error?.message)}}))}getProductBySlug(t,{slug:r}){return this.themeOptionService.preloader=!0,this.productService.getProductBySlug(r).pipe(h({next:e=>{if(e){e.related_products=e.related_products?.length?e.related_products:[],e.cross_sell_products=e.cross_sell_products?.length?e.cross_sell_products:[];let o=[...e.related_products||[],...e.cross_sell_products||[]],a=e?.categories?.map(l=>l.id)||[];(o.length||a.length)&&this.store.dispatch(new I({ids:o?.join(","),category_ids:a?.join(","),status:1}));let s=t.getState();t.patchState(g(p({},s),{selectedProduct:e}))}},complete:()=>{this.themeOptionService.preloader=!1},error:e=>{throw this.themeOptionService.preloader=!1,this.router.navigate(["/404"]),new Error(e?.error?.message)}}))}getRelatedProducts(t,r){return this.themeOptionService.preloader=!0,this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();t.patchState(g(p({},o),{relatedProducts:e.data}))},complete:()=>{this.themeOptionService.preloader=!1},error:e=>{throw new Error(e?.error?.message)}}))}getCategoryProducts(t,r){return this.productService.skeletonCategoryProductLoader=!0,this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();e.data.map(l=>{l.categories_ids=l?.categories?.map(f=>f.id)||[]});let a=e.data.filter(l=>l?.categories_ids?.includes(r.payload.category_id)),s=a.length;a.splice(r.payload.paginate),t.patchState(g(p({},o),{product:{data:[...o.product.data,...e.data],total:o.product.data.length+e.data.length},categoryProducts:a,categoryProductsTotal:s})),this.productService.skeletonCategoryProductLoader=!1},complete:()=>{this.productService.skeletonCategoryProductLoader=!1,this.themeOptionService.preloader=!1},error:e=>{throw new Error(e?.error?.message)}}))}getStoreProducts(t,r){return this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();t.patchState(g(p({},o),{storeProducts:e.data}))},error:e=>{throw new Error(e?.error?.message)}}))}getMenuProducts(t,r){if(!(t.getState().menuProducts.length>0))return this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();t.patchState(g(p({},o),{menuProducts:e.data}))},error:e=>{throw new Error(e?.error?.message)}}))}getProductBySearch(t,r){return this.productService.searchSkeleton=!0,this.productService.getProducts(r.payload).pipe(h({next:e=>{let o;r?.payload?.search?o=e.data.filter(a=>a.name.toLowerCase().includes(r?.payload?.search.toLowerCase())):o=e.data,t.patchState({productBySearch:o.splice(0,4)})},complete:()=>{this.productService.searchSkeleton=!1},error:e=>{throw new Error(e?.error?.message)}}))}getProductBySearchList(t,r){if(!(t.getState().productBySearchList.length>0))return this.productService.searchSkeleton=!0,this.productService.getProductBySearchList(r.payload).pipe(h({next:e=>{t.patchState({productBySearchList:e.data})},complete:()=>{this.productService.searchSkeleton=!1}}),k(()=>(this.productService.searchSkeleton=!1,t.patchState({productBySearchList:[]}),b)))}getMoreProduct(t,r){return this.productService.getProducts(r.payload).pipe(h({next:e=>{let o=t.getState();e.data.map(B=>{B.categories_ids=B?.categories?.map(_=>_.id)||[]});let a=e.data.filter(B=>r.payload.category_id?.some(_=>B.categories_ids.includes(_))),s=r.payload.page,l=r.payload.paginate,f=(s-1)*l,Q=f+l,C=a.length?a:e.data.slice(f,Q);r.value?t.patchState({moreProduct:[...o.moreProduct,...C]}):t.patchState({moreProduct:[...C]})},error:e=>{throw new Error(e?.error?.message)}}))}static{this.\u0275fac=function(r){return new(r||v)}}static{this.\u0275prov=m({token:v,factory:v.\u0275fac})}};c([i(O)],d.prototype,"getProducts",null);c([i($)],d.prototype,"getProductByIds",null);c([i(x)],d.prototype,"getProductBySlug",null);c([i(I)],d.prototype,"getRelatedProducts",null);c([i(R)],d.prototype,"getCategoryProducts",null);c([i(T)],d.prototype,"getStoreProducts",null);c([i(M)],d.prototype,"getMenuProducts",null);c([i(z)],d.prototype,"getProductBySearch",null);c([i(F)],d.prototype,"getProductBySearchList",null);c([i(U)],d.prototype,"getMoreProduct",null);c([n()],d,"product",null);c([n()],d,"productByIds",null);c([n()],d,"productBySearch",null);c([n()],d,"productBySearchList",null);c([n()],d,"selectedProduct",null);c([n()],d,"relatedProducts",null);c([n()],d,"categoryProducts",null);c([n()],d,"categoryProductsTotal",null);c([n()],d,"storeProducts",null);c([n()],d,"menuProducts",null);c([n()],d,"moreProduct",null);d=c([w({name:"product",defaults:{product:{data:[],total:0},selectedProduct:null,categoryProducts:[],categoryProductsTotal:0,relatedProducts:[],storeProducts:[],dealProducts:[],menuProducts:[],productBySearch:[],productBySearchList:[],productByIds:[],moreProduct:[]}})],d);var D=(()=>{class u{static{this.type="[Loader] Show loader action"}constructor(r=!0){this.loading=r}}return u})(),J=(()=>{class u{static{this.type="[Loader] Hide loader action"}}return u})(),K=(()=>{class u{static{this.type="[Loader] Show Button Spinner action"}constructor(r=!0,e){this.loading=r,this.id=e}}return u})(),N=(()=>{class u{static{this.type="[Loader] Hide Button Spinner action"}}return u})();var S=class A{static status(t){return t.status}static loadingCount(t){return t?.loadingCount}static buttonSpinner(t){return t.button_spinner}showLoaderAction(t,r){let e=t.getState(),o=e?.loadingCount?e?.loadingCount:0;t.patchState({status:r?.loading,loadingCount:o+1})}hideLoaderAction(t){let r=t.getState();t.patchState({status:r?.loadingCount!==1,loadingCount:r?.loadingCount-1})}showButtonSpinnerAction(t,r){let e=t.getState();t.patchState(g(p({},e),{button_spinner:r?.loading}))}HideButtonSpinnerAction(t){let r=t.getState();t.patchState(g(p({},r),{button_spinner:!1}))}static{this.\u0275fac=function(r){return new(r||A)}}static{this.\u0275prov=m({token:A,factory:A.\u0275fac})}};c([i(D)],S.prototype,"showLoaderAction",null);c([i(J)],S.prototype,"hideLoaderAction",null);c([i(K)],S.prototype,"showButtonSpinnerAction",null);c([i(N)],S.prototype,"HideButtonSpinnerAction",null);c([n()],S,"status",null);c([n()],S,"loadingCount",null);c([n()],S,"buttonSpinner",null);S=c([w({name:"loader",defaults:{status:!1,loadingCount:0,button_spinner:!1,button_id:null}})],S);export{q as a,d as b,D as c,J as d,K as e,N as f,S as g};
