{
  "version": 3,
  "sources": ["src/app/shared/store/state/auth.state.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\nimport { Router } from '@angular/router';\n\nimport { Action, Selector, State, StateContext, Store } from '@ngxs/store';\nimport { tap } from 'rxjs';\n\nimport { IAuthNumberLoginState } from '../../interface/auth.interface';\nimport { AuthService } from '../../services/auth.service';\nimport { NotificationService } from '../../services/notification.service';\nimport { AccountClearAction, GetUserDetailsAction } from '../action/account.action';\nimport {\n  AuthClearAction,\n  ForgotPasswordAction,\n  LoginAction,\n  LoginWithNumberAction,\n  LogoutAction,\n  RegisterAction,\n  SendEmailOtpAction,\n  UpdatePasswordAction,\n  VerifyEmailOtpAction,\n  VerifyNumberOTPAction,\n  VerifyOTPAction,\n} from '../action/auth.action';\nimport { ClearCartAction } from '../action/cart.action';\n\nexport interface AuthStateModel {\n  email: String;\n  number: IAuthNumberLoginState | null;\n  token: String | Number;\n  access_token: String | null;\n  permissions: [];\n  processId: string;\n}\n\n@State<AuthStateModel>({\n  name: 'auth',\n  defaults: {\n    email: '',\n    token: '',\n    number: null,\n    access_token: '',\n    permissions: [],\n    processId: '',\n  },\n})\n@Injectable()\nexport class AuthState {\n  private store = inject(Store);\n  router = inject(Router);\n  private authService = inject(AuthService);\n  private notificationService = inject(NotificationService);\n\n  @Selector()\n  static accessToken(state: AuthStateModel): String | null {\n    return state.access_token;\n  }\n\n  @Selector()\n  static isAuthenticated(state: AuthStateModel): Boolean {\n    return !!state.access_token;\n  }\n\n  @Selector()\n  static email(state: AuthStateModel): String {\n    return state.email;\n  }\n\n  @Selector()\n  static number(state: AuthStateModel): IAuthNumberLoginState | null {\n    return state.number;\n  }\n\n  @Selector()\n  static token(state: AuthStateModel): String | Number {\n    return state.token;\n  }\n\n  @Action(RegisterAction)\n  register(_ctx: StateContext<AuthStateModel>, action: RegisterAction) {\n    return this.authService.register(action.payload).pipe(\n      tap({\n        next: () => {\n          this.notificationService.showSuccess('Account created successfully! Please sign in.');\n        },\n        error: (err) => {\n          this.notificationService.showError(\n            err?.error?.message || 'Registration failed. Please try again.',\n          );\n        },\n      }),\n    );\n  }\n\n  @Action(LoginAction)\n  login(ctx: StateContext<AuthStateModel>, action: LoginAction) {\n    return this.authService.login(action.payload).pipe(\n      tap({\n        next: (res: any) => {\n          ctx.patchState({\n            email: action.payload.phone,\n            token: res.token || '',\n            access_token: res.token || '',\n          });\n          this.store.dispatch(new GetUserDetailsAction());\n        },\n        error: (err) => {\n          this.notificationService.showError(\n            err?.error?.message || 'Invalid credentials. Please try again.',\n          );\n        },\n      }),\n    );\n  }\n\n  @Action(LoginWithNumberAction)\n  loginWithNumber(_ctx: StateContext<AuthStateModel>, _action: LoginWithNumberAction) {\n    // Login with number logic here\n    this.store.dispatch(new GetUserDetailsAction());\n  }\n\n  @Action(ForgotPasswordAction)\n  forgotPassword(ctx: StateContext<AuthStateModel>, action: ForgotPasswordAction) {\n    return this.authService.sendOtp(action.payload.email).pipe(\n      tap({\n        next: (res: any) => {\n          ctx.patchState({\n            email: action.payload.email,\n            processId: res.processId || '',\n          });\n        },\n        error: (err) => {\n          this.notificationService.showError(\n            err?.error?.message || 'Failed to send OTP. Please check your email and try again.',\n          );\n        },\n      }),\n    );\n  }\n\n  @Action(SendEmailOtpAction)\n  sendEmailOtp(ctx: StateContext<AuthStateModel>, action: SendEmailOtpAction) {\n    return this.authService.sendEmailOtp(action.payload.email).pipe(\n      tap({\n        next: (res: any) => {\n          ctx.patchState({\n            email: action.payload.email,\n            processId: res.processId || '',\n          });\n        },\n        error: (err) => {\n          this.notificationService.showError(\n            err?.error?.message || 'Failed to send OTP. Please try again.',\n          );\n        },\n      }),\n    );\n  }\n\n  @Action(VerifyEmailOtpAction)\n  verifyEmailOtp(_ctx: StateContext<AuthStateModel>, action: VerifyEmailOtpAction) {\n    return this.authService.verifyEmailOtp(action.payload).pipe(\n      tap({\n        error: (err) => {\n          this.notificationService.showError(\n            err?.error?.message || 'Invalid or expired OTP. Please try again.',\n          );\n        },\n      }),\n    );\n  }\n\n  @Action(VerifyOTPAction)\n  verifyEmail(ctx: StateContext<AuthStateModel>, action: VerifyOTPAction) {\n    ctx.patchState({ token: action.payload.token });\n  }\n\n  @Action(VerifyNumberOTPAction)\n  verifyNumber(_ctx: StateContext<AuthStateModel>, _action: VerifyNumberOTPAction) {\n    this.store.dispatch(new GetUserDetailsAction());\n  }\n\n  @Action(UpdatePasswordAction)\n  updatePassword(ctx: StateContext<AuthStateModel>, action: UpdatePasswordAction) {\n    const state = ctx.getState();\n    return this.authService\n      .verifyOtpAndChangePassword({\n        email: action.payload.email,\n        otp: action.payload.token,\n        processId: state.processId,\n        newPassword: action.payload.password,\n      })\n      .pipe(\n        tap({\n          next: () => {\n            ctx.patchState({ token: '', processId: '' });\n            this.notificationService.showSuccess(\n              'Password updated successfully. Please sign in.',\n            );\n          },\n          error: (err) => {\n            this.notificationService.showError(\n              err?.error?.message || 'Failed to update password. Please try again.',\n            );\n          },\n        }),\n      );\n  }\n\n  @Action(LogoutAction)\n  logout(_ctx: StateContext<AuthStateModel>) {\n    this.store.dispatch(new AuthClearAction());\n    void this.router.navigate(['/']);\n  }\n\n  @Action(AuthClearAction)\n  authClear(ctx: StateContext<AuthStateModel>) {\n    ctx.patchState({\n      email: '',\n      token: '',\n      access_token: null,\n      permissions: [],\n      processId: '',\n    });\n    this.authService.redirectUrl = undefined;\n    this.store.dispatch(new AccountClearAction());\n    this.store.dispatch(new ClearCartAction());\n  }\n}\n"],
  "mappings": "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",
  "names": ["AuthState"]
}
