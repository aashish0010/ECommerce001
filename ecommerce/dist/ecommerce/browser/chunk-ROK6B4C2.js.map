{
  "version": 3,
  "sources": ["src/app/shared/store/action/account.action.ts", "src/app/shared/services/account.service.ts", "src/app/shared/store/state/account.state.ts"],
  "sourcesContent": ["import { IAccountUserUpdatePassword } from '../../interface/account.interface';\nimport { IUserAddress } from '../../interface/user.interface';\n\nexport class GetUserDetailsAction {\n  static readonly type = '[Account] User Get';\n  constructor() {}\n}\n\nexport class UpdateUserProfileAction {\n  static readonly type = '[Account] User Update';\n  constructor(public payload: any) {}\n}\n\nexport class UpdateUserPasswordAction {\n  static readonly type = '[Account] User Update Password';\n  constructor(public payload: IAccountUserUpdatePassword) {}\n}\n\nexport class GetAddressesAction {\n  static readonly type = '[Account] Addresses Get';\n  constructor() {}\n}\n\nexport class CreateAddressAction {\n  static readonly type = '[Account] Address Create';\n  constructor(public payload: any) {}\n}\n\nexport class UpdateAddressAction {\n  static readonly type = '[Account] Address Edit';\n  constructor(\n    public payload: IUserAddress,\n    public id: number,\n  ) {}\n}\n\nexport class DeleteAddressAction {\n  static readonly type = '[Account] Address Delete';\n  constructor(public id: number) {}\n}\n\nexport class AccountClearAction {\n  static readonly type = '[Account] Clear';\n  constructor() {}\n}\n", "import { HttpClient } from '@angular/common/http';\nimport { Injectable, inject } from '@angular/core';\n\nimport { Observable } from 'rxjs';\n\nimport { environment } from '../../../environments/environment';\nimport { IAccountUser, IAccountUserUpdatePassword } from '../interface/account.interface';\nimport { ISavedAddress } from '../interface/user.interface';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AccountService {\n  private http = inject(HttpClient);\n\n  public isOpenMenu: boolean = false;\n\n  getUserDetails(): Observable<IAccountUser> {\n    return this.http.get<IAccountUser>(`${environment.baseURL}user/me`);\n  }\n\n  updateProfile(data: { firstName?: string; middleName?: string; lastName?: string; phoneNumber?: string }): Observable<any> {\n    return this.http.put(`${environment.baseURL}user/profile`, data);\n  }\n\n  updatePassword(data: IAccountUserUpdatePassword): Observable<any> {\n    return this.http.put(`${environment.baseURL}user/password`, {\n      currentPassword: data.current_password,\n      newPassword: data.new_password,\n      confirmPassword: data.confirm_password,\n    });\n  }\n\n  getAddresses(): Observable<ISavedAddress[]> {\n    return this.http.get<ISavedAddress[]>(`${environment.baseURL}address`);\n  }\n\n  createAddress(payload: any): Observable<ISavedAddress> {\n    return this.http.post<ISavedAddress>(`${environment.baseURL}address`, payload);\n  }\n\n  updateAddress(id: number, payload: any): Observable<ISavedAddress> {\n    return this.http.put<ISavedAddress>(`${environment.baseURL}address/${id}`, payload);\n  }\n\n  deleteAddress(id: number): Observable<any> {\n    return this.http.delete(`${environment.baseURL}address/${id}`);\n  }\n}\n", "import { Injectable, inject } from '@angular/core';\n\nimport { Action, Selector, State, StateContext } from '@ngxs/store';\nimport { tap } from 'rxjs';\n\nimport { IAccountUser } from '../../interface/account.interface';\nimport { ISavedAddress } from '../../interface/user.interface';\nimport { AccountService } from '../../services/account.service';\nimport { NotificationService } from '../../services/notification.service';\nimport {\n  AccountClearAction,\n  CreateAddressAction,\n  DeleteAddressAction,\n  GetAddressesAction,\n  GetUserDetailsAction,\n  UpdateAddressAction,\n  UpdateUserPasswordAction,\n  UpdateUserProfileAction,\n} from '../action/account.action';\n\nexport class AccountStateModel {\n  user: IAccountUser | null;\n  permissions: any[];\n  addresses: ISavedAddress[];\n}\n\n@State<AccountStateModel>({\n  name: 'account',\n  defaults: {\n    user: null,\n    permissions: [],\n    addresses: [],\n  },\n})\n@Injectable()\nexport class AccountState {\n  private accountService = inject(AccountService);\n  private notificationService = inject(NotificationService);\n\n  @Selector()\n  static user(state: AccountStateModel) {\n    return state.user;\n  }\n\n  @Selector()\n  static permissions(state: AccountStateModel) {\n    return state.permissions;\n  }\n\n  @Selector()\n  static addresses(state: AccountStateModel) {\n    return state.addresses;\n  }\n\n  @Action(GetUserDetailsAction)\n  getUserDetails(ctx: StateContext<AccountStateModel>) {\n    return this.accountService.getUserDetails().pipe(\n      tap({\n        next: result => {\n          const user: IAccountUser = {\n            ...result,\n            name: [result.firstName, result.middleName, result.lastName].filter(Boolean).join(' ') || result.name,\n            phone: result.phoneNumber || result.phone,\n          };\n          ctx.patchState({\n            user,\n            permissions: result.permission || [],\n          });\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(UpdateUserProfileAction)\n  updateProfile(ctx: StateContext<AccountStateModel>, { payload }: UpdateUserProfileAction) {\n    // Profile image upload via FormData is not yet supported by the backend\n    if (payload instanceof FormData) {\n      this.notificationService.showError('Profile image upload is not yet supported');\n      return;\n    }\n    return this.accountService.updateProfile(payload).pipe(\n      tap({\n        next: () => {\n          this.notificationService.showSuccess('Profile updated successfully');\n          // Patch state locally â€” no extra API round-trip needed\n          const current = ctx.getState().user;\n          if (current) {\n            const updatedName = [payload.firstName, payload.middleName, payload.lastName]\n              .filter(Boolean).join(' ');\n            ctx.patchState({\n              user: {\n                ...current,\n                firstName: payload.firstName ?? current.firstName,\n                middleName: payload.middleName ?? current.middleName,\n                lastName: payload.lastName ?? current.lastName,\n                phoneNumber: payload.phoneNumber ?? current.phoneNumber,\n                phone: payload.phoneNumber ?? current.phone,\n                name: updatedName || current.name,\n              },\n            });\n          }\n        },\n        error: err => {\n          this.notificationService.showError(err?.error?.message || 'Failed to update profile');\n        },\n      }),\n    );\n  }\n\n  @Action(UpdateUserPasswordAction)\n  updatePassword(ctx: StateContext<AccountStateModel>, { payload }: UpdateUserPasswordAction) {\n    return this.accountService.updatePassword(payload).pipe(\n      tap({\n        next: () => {\n          this.notificationService.showSuccess('Password changed successfully');\n        },\n        error: err => {\n          this.notificationService.showError(err?.error?.message || 'Failed to change password');\n        },\n      }),\n    );\n  }\n\n  @Action(GetAddressesAction)\n  getAddresses(ctx: StateContext<AccountStateModel>) {\n    return this.accountService.getAddresses().pipe(\n      tap({\n        next: result => {\n          ctx.patchState({ addresses: result });\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(CreateAddressAction)\n  createAddress(ctx: StateContext<AccountStateModel>, { payload }: CreateAddressAction) {\n    return this.accountService.createAddress(payload).pipe(\n      tap({\n        next: result => {\n          const state = ctx.getState();\n          ctx.patchState({\n            addresses: [...state.addresses, result],\n          });\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(UpdateAddressAction)\n  updateAddress(ctx: StateContext<AccountStateModel>, { id, payload }: UpdateAddressAction) {\n    return this.accountService.updateAddress(id, payload).pipe(\n      tap({\n        next: (updated) => {\n          const state = ctx.getState();\n          ctx.patchState({\n            addresses: state.addresses.map(a => a.id === id ? updated : a),\n          });\n          this.notificationService.showSuccess('Address updated successfully');\n        },\n        error: err => {\n          this.notificationService.showError(err?.error?.message || 'Failed to update address');\n        },\n      }),\n    );\n  }\n\n  @Action(DeleteAddressAction)\n  deleteAddress(ctx: StateContext<AccountStateModel>, { id }: DeleteAddressAction) {\n    return this.accountService.deleteAddress(id).pipe(\n      tap({\n        next: () => {\n          const state = ctx.getState();\n          ctx.patchState({\n            addresses: state.addresses.filter(a => a.id !== id),\n          });\n          this.notificationService.showSuccess('Address deleted successfully');\n        },\n        error: err => {\n          this.notificationService.showError(err?.error?.message || 'Failed to delete address');\n        },\n      }),\n    );\n  }\n\n  @Action(AccountClearAction)\n  accountClear(ctx: StateContext<AccountStateModel>) {\n    ctx.patchState({\n      user: null,\n      permissions: [],\n      addresses: [],\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": ["AccountState"]
}
