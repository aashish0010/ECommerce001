import{g as S}from"./chunk-NLS3CEED.js";import{i as I}from"./chunk-X54HSUE6.js";import{a as d}from"./chunk-XBPV4G5P.js";import{k as C,m as n,n as v,o as l}from"./chunk-HS6BDBTJ.js";import{A as u}from"./chunk-QOHFTPSE.js";import{X as p,ca as m,ha as c,i}from"./chunk-63KUFEGV.js";var f=(()=>{class a{static{this.type="[Compare] Get"}}return a})(),A=(()=>{class a{static{this.type="[Compare] post"}constructor(t){this.payload=t}}return a})(),y=(()=>{class a{static{this.type="[Compare] delete"}constructor(t){this.id=t}}return a})();var g=(()=>{class a{constructor(){this.http=c(u),this.skeletonLoader=!1}getComparItems(){return this.http.get(`${d.baseURL}compare`)}addToCompare(t){return this.http.post(`${d.baseURL}compare`,{product_id:t})}removeFromCompare(t){return this.http.delete(`${d.baseURL}compare/${t}`)}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var s=class h{constructor(){this.store=c(C),this.router=c(S),this.notificationService=c(I),this.compareService=c(g)}static compareItems(e){return e.items}static compareIds(e){return e.comparIds}static compareTotal(e){return e.total}getCompareItems(e){if(this.store.selectSnapshot(t=>t.auth&&t.auth.access_token))return this.compareService.skeletonLoader=!0,this.compareService.getComparItems().pipe(p({next:t=>{let o=Array.isArray(t)?t:t.data||[],r=o.map(w=>w.id);e.patchState({items:o,total:t?.total?t.total:o.length,comparIds:r})},complete:()=>{this.compareService.skeletonLoader=!1},error:t=>{throw this.compareService.skeletonLoader=!1,new Error(t?.error?.message)}}))}add(e,t){if(!this.store.selectSnapshot(r=>r.auth&&r.auth.access_token)){this.notificationService.showError("Please login to compare products.");return}let o=t.payload?.product_id;if(o)return this.compareService.addToCompare(o).pipe(p({next:()=>{let r=e.getState();r.comparIds.includes(o)||e.patchState({comparIds:[...r.comparIds,o]}),this.notificationService.showSuccess("Added to compare."),this.store.dispatch(new f)},error:r=>{this.notificationService.showError(r?.error?.message||"Failed to add to compare.")}}))}delete(e,{id:t}){return this.compareService.removeFromCompare(t).pipe(p({next:()=>{let o=e.getState();e.patchState({items:o.items.filter(r=>r.id!==t),total:o.total-1,comparIds:o.comparIds.filter(r=>r!==t)}),this.notificationService.showSuccess("Removed from compare.")},error:o=>{this.notificationService.showError(o?.error?.message||"Failed to remove from compare.")}}))}static{this.\u0275fac=function(t){return new(t||h)}}static{this.\u0275prov=m({token:h,factory:h.\u0275fac})}};i([n(f)],s.prototype,"getCompareItems",null);i([n(A)],s.prototype,"add",null);i([n(y)],s.prototype,"delete",null);i([l()],s,"compareItems",null);i([l()],s,"compareIds",null);i([l()],s,"compareTotal",null);s=i([v({name:"compare",defaults:{items:[],total:0,comparIds:[]}})],s);export{f as a,A as b,y as c,g as d,s as e};
