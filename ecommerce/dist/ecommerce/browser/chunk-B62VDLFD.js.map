{
  "version": 3,
  "sources": ["src/app/shared/services/category.service.ts", "src/app/shared/store/state/category.state.ts"],
  "sourcesContent": ["import { HttpClient } from '@angular/common/http';\nimport { Injectable, inject } from '@angular/core';\n\nimport { Observable, catchError, map, shareReplay, throwError } from 'rxjs';\n\nimport { environment } from '../../../environments/environment';\nimport { ICategory, ICategoryModel } from '../interface/category.interface';\nimport { Params } from '../interface/core.interface';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CategoryService {\n  private http = inject(HttpClient);\n\n  public searchSkeleton: boolean = false;\n\n  // Single shared observable — all concurrent callers share one HTTP request per session\n  private _cache$: Observable<ICategoryModel> | null = null;\n\n  getCategories(_payload?: Params): Observable<ICategoryModel> {\n    // Return in-memory cache if available (prevents duplicate HTTP calls within the session)\n    if (this._cache$) return this._cache$;\n\n    // Fetch from API — shareReplay(1) ensures all concurrent callers share one request\n    this._cache$ = this.http\n      .get<any>(`${environment.baseURL}product/categories`, {\n        params: { companyInfoId: environment.companyInfoId, status: 1 },\n      })\n      .pipe(\n        map(res => {\n          const categories = (res.data || res.categories || []) as ICategory[];\n          // Return a shallow copy so callers cannot mutate the shared cached reference\n          return { data: [...categories], total: categories.length } as ICategoryModel;\n        }),\n        shareReplay(1),\n        catchError(err => {\n          this._cache$ = null; // Reset so the next call retries\n          return throwError(() => err);\n        }),\n      );\n\n    return this._cache$;\n  }\n\n  getCategoryBySlug(slug: string): Observable<ICategory> {\n    return this.getCategories().pipe(\n      map(res => {\n        const allCategories = res.data || [];\n        for (const cat of allCategories) {\n          if (cat.slug === slug) return cat;\n          if (cat.subcategories?.length) {\n            const sub = cat.subcategories.find(s => s.slug === slug);\n            if (sub) return sub;\n          }\n        }\n        return allCategories[0];\n      }),\n    );\n  }\n}\n", "import { Injectable, inject } from '@angular/core';\n\nimport { Action, Selector, State, StateContext } from '@ngxs/store';\nimport { tap } from 'rxjs';\n\nimport { ICategory } from '../../interface/category.interface';\nimport { CategoryService } from '../../services/category.service';\nimport {\n  GetCategoriesAction,\n  GetCategoryAction,\n  GetCategoryBySlugAction,\n  GetFooterCategoriesAction,\n  GetHeaderCategoriesAction,\n  GetProductCategoryAction,\n  GetSearchByCategoryAction,\n} from '../action/category.action';\n\nexport class CategoryStateModel {\n  category = {\n    data: [] as ICategory[],\n    total: 0,\n  };\n  categories = {\n    data: [] as ICategory[],\n    total: 0,\n  };\n  footerCategory = {\n    data: [] as ICategory[],\n    total: 0,\n  };\n  headerCategory = {\n    data: [] as ICategory[],\n    total: 0,\n  };\n  productCategory = {\n    data: [] as ICategory[],\n    total: 0,\n  };\n  searchByCategory: ICategory[];\n  selectedCategory: ICategory | null;\n}\n\n@State<CategoryStateModel>({\n  name: 'category',\n  defaults: {\n    category: {\n      data: [],\n      total: 0,\n    },\n    categories: {\n      data: [],\n      total: 0,\n    },\n    footerCategory: {\n      data: [],\n      total: 0,\n    },\n    headerCategory: {\n      data: [],\n      total: 0,\n    },\n    productCategory: {\n      data: [],\n      total: 0,\n    },\n    searchByCategory: [],\n    selectedCategory: null,\n  },\n})\n@Injectable()\nexport class CategoryState {\n  private categoryService = inject(CategoryService);\n\n  @Selector()\n  static category(state: CategoryStateModel) {\n    return state.category;\n  }\n\n  @Selector()\n  static categories(state: CategoryStateModel) {\n    return state.categories;\n  }\n\n  @Selector()\n  static footerCategory(state: CategoryStateModel) {\n    return state.footerCategory;\n  }\n\n  @Selector()\n  static headerCategory(state: CategoryStateModel) {\n    return state.headerCategory;\n  }\n\n  @Selector()\n  static productCategory(state: CategoryStateModel) {\n    return state.productCategory;\n  }\n\n  @Selector()\n  static subCategory(state: CategoryStateModel) {\n    return state.category;\n  }\n\n  @Selector()\n  static searchByCategory(state: CategoryStateModel) {\n    return state.searchByCategory;\n  }\n\n  @Selector()\n  static selectedCategory(state: CategoryStateModel) {\n    return state.selectedCategory;\n  }\n\n  @Action(GetCategoriesAction)\n  getCategories(ctx: StateContext<CategoryStateModel>, action: GetCategoriesAction) {\n    if (ctx.getState().categories.data.length > 0) return;\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          if (result && result.data) {\n            ctx.patchState({\n              categories: {\n                data: result.data,\n                total: result?.total ? result?.total : result.data.length,\n              },\n            });\n          }\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(GetCategoryAction)\n  getCategory(ctx: StateContext<CategoryStateModel>, action: GetCategoryAction) {\n    if (ctx.getState().category.data.length > 0) return;\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          if (result && result.data) {\n            ctx.patchState({\n              category: {\n                data: result.data,\n                total: result?.total ? result?.total : result.data.length,\n              },\n            });\n          }\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(GetFooterCategoriesAction)\n  GetFooterCategories(ctx: StateContext<CategoryStateModel>, action: GetFooterCategoriesAction) {\n    if (ctx.getState().footerCategory.data.length > 0) return;\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          if (result && result.data) {\n            ctx.patchState({\n              footerCategory: {\n                data: result.data,\n                total: result?.total ? result?.total : result.data.length,\n              },\n            });\n          }\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(GetHeaderCategoriesAction)\n  GetHeaderCategories(ctx: StateContext<CategoryStateModel>, action: GetHeaderCategoriesAction) {\n    if (ctx.getState().headerCategory.data.length > 0) return;\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          if (result && result.data) {\n            ctx.patchState({\n              headerCategory: {\n                data: result.data,\n                total: result?.total ? result?.total : result.data.length,\n              },\n            });\n          }\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(GetProductCategoryAction)\n  GetProductCategory(ctx: StateContext<CategoryStateModel>, action: GetProductCategoryAction) {\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          ctx.patchState({\n            productCategory: {\n              data: result.data,\n              total: result?.total ? result?.total : result.data.length,\n            },\n          });\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  @Action(GetSearchByCategoryAction)\n  getSearchByCategory(ctx: StateContext<CategoryStateModel>, action: GetSearchByCategoryAction) {\n    this.categoryService.searchSkeleton = true;\n    return this.categoryService.getCategories(action.payload).pipe(\n      tap({\n        next: result => {\n          let categories;\n          if (action?.payload?.['search']) {\n            categories = result.data.filter(category =>\n              category.name.toLowerCase().includes(action?.payload?.['search'].toLowerCase()),\n            );\n          } else {\n            categories = result.data;\n          }\n          ctx.patchState({\n            searchByCategory: categories ? categories.slice(0, 4) : [],\n          });\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n        complete: () => {\n          this.categoryService.searchSkeleton = false;\n        },\n      }),\n    );\n  }\n\n  @Action(GetCategoryBySlugAction)\n  getCategoryBySlug(ctx: StateContext<CategoryStateModel>, action: GetCategoryBySlugAction) {\n    return this.categoryService.getCategories().pipe(\n      tap({\n        next: results => {\n          if (results && results.data) {\n            const result = results.data.find(category => category.slug == action.slug);\n            const state = ctx.getState();\n            ctx.patchState({\n              ...state,\n              selectedCategory: result,\n            });\n          }\n        },\n        error: err => {\n          throw new Error(err?.error?.message);\n        },\n      }),\n    );\n  }\n\n  getSubCategory(category: ICategory, ids: number[]) {\n    if (ids?.includes(category.id)) {\n      if (category) {\n        return category;\n      }\n    }\n\n    if (category.subcategories?.length) {\n      category.subcategories.map(subcategory => {\n        this.getSubCategory(subcategory, ids);\n      });\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": ["CategoryState"]
}
