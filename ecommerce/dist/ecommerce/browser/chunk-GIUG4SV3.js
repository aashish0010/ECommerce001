import{j as f}from"./chunk-DRBHFQD7.js";import{a as w,b as A,c as P,d as k,e as E,f as O,g as I,h as b,i as _,j as x,k as u}from"./chunk-NL66A4LO.js";import{a as g}from"./chunk-EUAE4TU4.js";import{a as l,g as S}from"./chunk-JA635JCW.js";import{g as d}from"./chunk-N3FRQ2KK.js";import{i as v}from"./chunk-F62LBTWT.js";import{$ as h,U as s,ea as c,g as i,od as m,qd as a,rd as y,sd as n}from"./chunk-XZ37OMXB.js";var o=class p{constructor(){this.store=c(m),this.router=c(d),this.authService=c(g),this.notificationService=c(v)}static accessToken(e){return e.access_token}static isAuthenticated(e){return!!e.access_token}static email(e){return e.email}static number(e){return e.number}static token(e){return e.token}register(e,t){return this.authService.register(t.payload).pipe(s({next:()=>{this.notificationService.showSuccess("Account created successfully! Please sign in.")},error:r=>{this.notificationService.showError(r?.error?.message||"Registration failed. Please try again.")}}))}login(e,t){return this.authService.login(t.payload).pipe(s({next:r=>{e.patchState({email:t.payload.phone,token:r.token||"",access_token:r.token||""}),this.store.dispatch(new l)},error:r=>{this.notificationService.showError(r?.error?.message||"Invalid credentials. Please try again.")}}))}loginWithNumber(e,t){this.store.dispatch(new l)}forgotPassword(e,t){return this.authService.sendOtp(t.payload.email).pipe(s({next:r=>{e.patchState({email:t.payload.email,processId:r.processId||""})},error:r=>{this.notificationService.showError(r?.error?.message||"Failed to send OTP. Please check your email and try again.")}}))}sendEmailOtp(e,t){return this.authService.sendEmailOtp(t.payload.email).pipe(s({next:r=>{e.patchState({email:t.payload.email,processId:r.processId||""})},error:r=>{this.notificationService.showError(r?.error?.message||"Failed to send OTP. Please try again.")}}))}verifyEmailOtp(e,t){return this.authService.verifyEmailOtp(t.payload).pipe(s({error:r=>{this.notificationService.showError(r?.error?.message||"Invalid or expired OTP. Please try again.")}}))}verifyEmail(e,t){e.patchState({token:t.payload.token})}verifyNumber(e,t){this.store.dispatch(new l)}updatePassword(e,t){let r=e.getState();return this.authService.verifyOtpAndChangePassword({email:t.payload.email,otp:t.payload.token,processId:r.processId,newPassword:t.payload.password}).pipe(s({next:()=>{e.patchState({token:"",processId:""}),this.notificationService.showSuccess("Password updated successfully. Please sign in.")},error:C=>{this.notificationService.showError(C?.error?.message||"Failed to update password. Please try again.")}}))}logout(e){this.store.dispatch(new u),this.router.navigate(["/"])}authClear(e){e.patchState({email:"",token:"",access_token:null,permissions:[],processId:""}),this.authService.redirectUrl=void 0,this.store.dispatch(new S),this.store.dispatch(new f)}static{this.\u0275fac=function(t){return new(t||p)}}static{this.\u0275prov=h({token:p,factory:p.\u0275fac})}};i([a(w)],o.prototype,"register",null);i([a(A)],o.prototype,"login",null);i([a(P)],o.prototype,"loginWithNumber",null);i([a(k)],o.prototype,"forgotPassword",null);i([a(E)],o.prototype,"sendEmailOtp",null);i([a(O)],o.prototype,"verifyEmailOtp",null);i([a(I)],o.prototype,"verifyEmail",null);i([a(b)],o.prototype,"verifyNumber",null);i([a(_)],o.prototype,"updatePassword",null);i([a(x)],o.prototype,"logout",null);i([a(u)],o.prototype,"authClear",null);i([n()],o,"accessToken",null);i([n()],o,"isAuthenticated",null);i([n()],o,"email",null);i([n()],o,"number",null);i([n()],o,"token",null);o=i([y({name:"auth",defaults:{email:"",token:"",number:null,access_token:"",permissions:[],processId:""}})],o);export{o as a};
