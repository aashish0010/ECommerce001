{
  "version": 3,
  "sources": ["src/app/shared/store/action/coupon.action.ts", "src/app/shared/services/coupon.service.ts", "src/app/shared/store/state/coupon.state.ts"],
  "sourcesContent": ["export class GetCouponsAction {\n  static readonly type = '[Coupon] Get';\n}\n\nexport class ApplyCouponAction {\n  static readonly type = '[Coupon] Apply';\n  constructor(public code: string, public subtotal: number) {}\n}\n\nexport class RemoveCouponAction {\n  static readonly type = '[Coupon] Remove';\n}\n", "import { HttpClient } from '@angular/common/http';\nimport { Injectable, inject } from '@angular/core';\n\nimport { Observable } from 'rxjs';\n\nimport { environment } from '../../../environments/environment';\nimport { IApplyCouponResponse, ICouponListResponse } from '../interface/coupon.interface';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CouponService {\n  private http = inject(HttpClient);\n\n  getCoupons(): Observable<ICouponListResponse> {\n    return this.http.get<ICouponListResponse>(`${environment.baseURL}coupon`);\n  }\n\n  applyCoupon(code: string, subtotal: number): Observable<IApplyCouponResponse> {\n    return this.http.post<IApplyCouponResponse>(`${environment.baseURL}coupon/apply`, {\n      code,\n      subtotal,\n      company_info_id: 1,\n    });\n  }\n}\n", "import { Injectable, inject } from '@angular/core';\n\nimport { Action, Selector, State, StateContext } from '@ngxs/store';\nimport { tap } from 'rxjs';\n\nimport { IApplyCouponResponse, ICoupon } from '../../interface/coupon.interface';\nimport { CouponService } from '../../services/coupon.service';\nimport { ApplyCouponAction, GetCouponsAction, RemoveCouponAction } from '../action/coupon.action';\n\nexport class CouponStateModel {\n  coupons: ICoupon[] = [];\n  appliedCoupon: IApplyCouponResponse | null = null;\n  couponError: string | null = null;\n}\n\n@State<CouponStateModel>({\n  name: 'coupon',\n  defaults: {\n    coupons: [],\n    appliedCoupon: null,\n    couponError: null,\n  },\n})\n@Injectable()\nexport class CouponState {\n  private couponService = inject(CouponService);\n\n  @Selector()\n  static coupons(state: CouponStateModel) {\n    return state.coupons;\n  }\n\n  @Selector()\n  static appliedCoupon(state: CouponStateModel) {\n    return state.appliedCoupon;\n  }\n\n  @Selector()\n  static couponError(state: CouponStateModel) {\n    return state.couponError;\n  }\n\n  @Action(GetCouponsAction)\n  getCoupons(ctx: StateContext<CouponStateModel>) {\n    return this.couponService.getCoupons().pipe(\n      tap({\n        next: result => {\n          ctx.patchState({ coupons: result.data ?? [] });\n        },\n        error: () => {\n          ctx.patchState({ coupons: [] });\n        },\n      }),\n    );\n  }\n\n  @Action(ApplyCouponAction)\n  applyCoupon(ctx: StateContext<CouponStateModel>, action: ApplyCouponAction) {\n    ctx.patchState({ couponError: null });\n    return this.couponService.applyCoupon(action.code, action.subtotal).pipe(\n      tap({\n        next: result => {\n          ctx.patchState({ appliedCoupon: result, couponError: null });\n        },\n        error: err => {\n          ctx.patchState({\n            appliedCoupon: null,\n            couponError: err?.error?.message ?? 'Invalid coupon code.',\n          });\n          throw new Error(err?.error?.message ?? 'Invalid coupon code.');\n        },\n      }),\n    );\n  }\n\n  @Action(RemoveCouponAction)\n  removeCoupon(ctx: StateContext<CouponStateModel>) {\n    ctx.patchState({ appliedCoupon: null, couponError: null });\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAAM,IAAO,mBAAP,MAAuB;;AACX,SAAA,OAAO;EAAe;;AAGlC,IAAO,oBAAP,MAAwB;;AACZ,SAAA,OAAO;EAAiB;EACxC,YAAmB,MAAqB,UAAgB;AAArC,SAAA,OAAA;AAAqB,SAAA,WAAA;EAAmB;;AAGvD,IAAO,qBAAP,MAAyB;;AACb,SAAA,OAAO;EAAkB;;;;ACCrC,IAAO,gBAAP,MAAO,eAAa;EAH1B,cAAA;AAIU,SAAA,OAAO,OAAO,UAAU;;EAEhC,aAAU;AACR,WAAO,KAAK,KAAK,IAAyB,GAAG,YAAY,OAAO,QAAQ;EAC1E;EAEA,YAAY,MAAc,UAAgB;AACxC,WAAO,KAAK,KAAK,KAA2B,GAAG,YAAY,OAAO,gBAAgB;MAChF;MACA;MACA,iBAAiB;KAClB;EACH;;;uCAbW,gBAAa;IAAA;EAAA;;4EAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;EAAA;;;sEAEP,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;;;ACcM,IAAM,cAAN,MAAMA,aAAW;EAAjB,cAAA;AACG,SAAA,gBAAgB,OAAO,aAAa;;EAG5C,OAAO,QAAQ,OAAuB;AACpC,WAAO,MAAM;EACf;EAGA,OAAO,cAAc,OAAuB;AAC1C,WAAO,MAAM;EACf;EAGA,OAAO,YAAY,OAAuB;AACxC,WAAO,MAAM;EACf;EAGA,WAAW,KAAmC;AAC5C,WAAO,KAAK,cAAc,WAAU,EAAG,KACrC,IAAI;MACF,MAAM,YAAS;AACb,YAAI,WAAW,EAAE,SAAS,OAAO,QAAQ,CAAA,EAAE,CAAE;MAC/C;MACA,OAAO,MAAK;AACV,YAAI,WAAW,EAAE,SAAS,CAAA,EAAE,CAAE;MAChC;KACD,CAAC;EAEN;EAGA,YAAY,KAAqC,QAAyB;AACxE,QAAI,WAAW,EAAE,aAAa,KAAI,CAAE;AACpC,WAAO,KAAK,cAAc,YAAY,OAAO,MAAM,OAAO,QAAQ,EAAE,KAClE,IAAI;MACF,MAAM,YAAS;AACb,YAAI,WAAW,EAAE,eAAe,QAAQ,aAAa,KAAI,CAAE;MAC7D;MACA,OAAO,SAAM;AACX,YAAI,WAAW;UACb,eAAe;UACf,aAAa,KAAK,OAAO,WAAW;SACrC;AACD,cAAM,IAAI,MAAM,KAAK,OAAO,WAAW,sBAAsB;MAC/D;KACD,CAAC;EAEN;EAGA,aAAa,KAAmC;AAC9C,QAAI,WAAW,EAAE,eAAe,MAAM,aAAa,KAAI,CAAE;EAC3D;;;uCAtDWA,cAAW;IAAA;EAAA;;4EAAXA,cAAW,SAAXA,aAAW,UAAA,CAAA;EAAA;;AAmBtB,WAAA;EADC,OAAO,gBAAgB;;AAexB,WAAA;EADC,OAAO,iBAAiB;;AAoBzB,WAAA;EADC,OAAO,kBAAkB;;AA/CnB,WAAA;EADN,SAAQ;;AAMF,WAAA;EADN,SAAQ;;AAMF,WAAA;EADN,SAAQ;;AAbE,cAAW,WAAA;EATvB,MAAwB;IACvB,MAAM;IACN,UAAU;MACR,SAAS,CAAA;MACT,eAAe;MACf,aAAa;;GAEhB;GAEY,WAAW;;sEAAX,aAAW,CAAA;UADvB;;;",
  "names": ["CouponState"]
}
